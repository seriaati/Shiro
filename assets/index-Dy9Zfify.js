import{j as e,r as c}from"./index-eBfVgE52.js";import{b as l}from"./use-event-callback-CThH6RIX.js";import{u as d}from"./LinkCard-LHZTKZ1N.js";import{u as v,q as A,w as I,x as M}from"./owner-CZdAjSqJ.js";import{a as R}from"./Markdown-Dkm4XVXZ.js";import{A as k}from"./Shiki-vnup1iyK.js";import{c as p,a as i}from"./helper-jIGjUHP-.js";import{g as L,u as T,M as F,C as E,a as P,b as U,c as O,d as w,e as g,f,h as V,i as $,R as q,I as W,F as G,U as j,j as H,k as K,l as _,s as u,m,n as X,o as Z,S as Q}from"./utils-CirsmDjB.js";import{A as D,m as h}from"./proxy-DhJZ-ECj.js";import{I as J}from"./Gallery--DxrzCSV.js";import{M as Y,S as ee}from"./StyledButton-C42gs1tK.js";import{u as se}from"./useQuery-DjMuQnpJ.js";import{G as te}from"./SocialSourceLink-BlJkNBjl.js";import"./provider-BSJX_ugC.js";import"./index-DzI2u2Jy.js";import"./index-CX1jgvwW.js";import"./index-QZLambGZ.js";import"./spring-BSAt5qpK.js";import"./bangumi-DGWEI3g8.js";import"./dom-BowoBODo.js";import"./use-combine-values-UE7avlZi.js";import"./index-B1FPs1CV.js";import"./use-motion-template-DE83R-dO.js";import"./index-eDFfAGam.js";import"./use-is-dark-DHNMQizj.js";import"./lodash-Ch6W0gOk.js";import"./FloatPopover-B5oX3wC8.js";import"./Collapse-CXQ00c7w.js";import"./use-is-unmounted-CXk0FDf2.js";import"./use-ref-value-CVi4GAz9.js";import"./index-XfpuRrHM.js";import"./customParseFormat-P8olLq1n.js";import"./use-animation-DOJ1yw2G.js";import"./visual-element-DOxF4dnJ.js";import"./use-spring-BHo7Hkcd.js";import"./use-drag-controls-Cf889mTi.js";const C=({className:s})=>{const a=l()?.provider,n=a&&L(a);return n?e.jsx("span",{className:p("pointer-events-none flex size-4 select-none items-center justify-center rounded-full bg-white dark:bg-zinc-900",s),children:e.jsx(n,{className:"size-3"})}):null};function ae({className:s}){return e.jsx("i",{className:i("i-mingcute-send-plane-line",s)})}const ne=()=>{const s=P(),t=U();return e.jsxs("span",{className:i("font-mono text-[10px]",s?"text-red-500":"text-zinc-500"),children:[t.length,"/",O]})},re=()=>{const s=d(),t=w(),a=v(g().isWhisper),n=f();return s||t?null:e.jsxs("label",{className:"label mx-2 flex items-center",children:[e.jsx("input",{className:"checkbox-accent checkbox checkbox-sm mr-2",checked:a,type:"checkbox",onChange:r=>{const{checked:o}=r.target;n("isWhisper",o)}}),e.jsx("span",{className:"label-text text-sm",children:"悄悄話"})]})},oe=()=>{const s=d(),t=v(g().syncToRecently),a=f(),n=w();return!s||n?null:e.jsxs("label",{className:"label mx-2 flex items-center",children:[e.jsx("input",{className:"checkbox-accent checkbox checkbox-sm mr-2",checked:t,type:"checkbox",onChange:r=>{const{checked:o}=r.target;a("syncToRecently",o)}}),e.jsx("span",{className:"label-text text-sm",children:"同步到碎碎念"})]})},b=({className:s})=>{const t=T();return e.jsxs("footer",{className:p("mt-3 flex h-5 w-full min-w-0 items-center justify-between",s),children:[e.jsxs("span",{className:i("flex-1 select-none text-[10px] text-zinc-500 transition-opacity"),children:[e.jsxs("span",{className:"hidden md:inline",children:["支持 ",e.jsx("b",{children:"Markdown"})," 與"," ",e.jsx(F,{href:"https://docs.github.com/zh/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax",children:"GFM"})]}),e.jsx(E,{})]}),e.jsx(D,{children:t&&e.jsxs(h.aside,{initial:{opacity:0,scale:.96,y:8},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.98,y:8},className:"flex select-none items-center gap-2.5",children:[e.jsx(ne,{}),e.jsx(re,{}),e.jsx(oe,{}),e.jsx(ie,{})]},"send-button-wrapper")})]})},ie=()=>{const[s,t]=V();return e.jsxs(h.button,{className:"flex appearance-none items-center space-x-1 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",disabled:t,onClick:s,children:[e.jsx(ae,{className:"size-5 text-zinc-800 dark:text-zinc-200"}),e.jsx(h.span,{className:"text-sm",layout:"size",children:t?"送信...":"送信"})]})},ce=()=>{const s=f(),t=l(),a=t?t.name||"Anonymous":"";return c.useEffect(()=>{t&&(s("author",a),s("avatar",t.image),s("mail",t.email),t.handle&&s("url",$({provider:t.provider,handle:t.handle})||""),s("source",t.provider))},[a,t,s]),t?e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:i("relative mb-2 shrink-0 select-none self-end rounded-full","bg-zinc-200 ring-2 ring-zinc-200 dark:bg-zinc-800","backface-hidden ml-[2px]"),children:[e.jsxs(q,{children:[e.jsx(W,{className:"rounded-full object-cover",src:t.image,alt:`${a}'s avatar`,width:48,height:48}),e.jsx(G,{delayMs:600,className:"block size-[48px] shrink-0 rounded-full"})]}),e.jsx(C,{className:"absolute -bottom-1 right-0"})]}),e.jsx("div",{className:"relative h-[150px] w-full rounded-xl bg-gray-200/50 dark:bg-zinc-800/50",children:e.jsx(j,{className:"pb-5"})}),e.jsx(b,{className:"absolute bottom-0 left-14 right-0 mb-2 ml-4 w-auto px-4"})]}):null},le=()=>d()?e.jsx(ue,{}):e.jsx(xe,{}),z="relative h-[150px] w-full rounded-xl bg-gray-200/50 dark:bg-zinc-800/50",me={author:"暱稱",mail:"郵箱",url:"網址"},de={author:{validator:s=>s.length>0&&s.length<=20,message:"暱稱长度应在 1-20 之間"},mail:{validator:s=>/^[\w-]+@[\w-]+(\.[\w-]+)+$/.test(s),message:"郵箱格式不正确"},url:{validator:s=>/^https?:\/\/[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/.test(s),message:"網址格式不正确"}},x=s=>{const{fieldKey:t,required:a}=s,[n,r]=I(g()[t]);return e.jsx(K,{type:"text",value:n,onChange:o=>r(o.target.value),required:a,placeholder:me[t]+(a?" *":""),name:t,className:"bg-gray-200/50 dark:bg-zinc-800/50",rules:[de[t]]})},xe=()=>e.jsxs(H,{className:"flex flex-col space-y-4 px-2 pt-2",showErrorMessage:!1,children:[e.jsxs("div",{className:"flex flex-col space-x-0 space-y-4 md:flex-row md:space-x-4 md:space-y-0",children:[e.jsx(x,{fieldKey:"author",required:!0}),e.jsx(x,{fieldKey:"mail",required:!0}),e.jsx(x,{fieldKey:"url"})]}),e.jsx("div",{className:z,children:e.jsx(j,{className:"pb-8"})}),e.jsx(b,{className:"absolute bottom-4 left-0 right-4 mb-2 ml-2 w-auto px-4"})]}),ue=()=>{const s=A(t=>t.user);return e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:i("relative mb-2 shrink-0 select-none self-end rounded-full","ring-2 ring-accent","backface-hidden ml-[2px]"),children:[e.jsx(J,{className:"rounded-full object-cover",src:s.avatar,alt:`${s.name||s.username}'s avatar`,width:48,height:48}),e.jsx(C,{className:"absolute -bottom-1 right-0"})]}),e.jsx("div",{className:z,children:e.jsx(j,{className:"pb-5"})}),e.jsx(b,{className:"absolute bottom-0 left-14 right-0 mb-2 ml-4 w-auto px-4"})]})},B=()=>{const{data:s}=se({queryKey:["providers"],queryFn:()=>M.proxy.auth.providers.get().then(t=>t.data),refetchOnMount:"always",meta:{persist:!0}});return s},he=()=>{const s=B(),[t,a]=c.useState(()=>new Set);return e.jsx(e.Fragment,{children:s&&e.jsx("ul",{className:"flex items-center justify-center gap-3",children:s.map(n=>e.jsx("li",{children:e.jsx(Y,{disabled:t.has(n),onClick:()=>{t.has(n)||(_.signIn.social({provider:n,callbackURL:window.location.href}),a(r=>(r.add(n),new Set(r))))},children:e.jsx("div",{className:"flex size-10 items-center justify-center rounded-full border bg-base-100 dark:border-neutral-700",children:t.has(n)?e.jsx("div",{className:"center flex",children:e.jsx("i",{className:"loading loading-spinner loading-xs opacity-50"})}):e.jsx(c.Fragment,{children:n==="github"?e.jsx(te,{}):e.jsx("img",{className:"size-4",src:`https://authjs.dev/img/providers/${n}.svg`})})})})},n))})})};function pe(){const s=!!l(),t=B(),a=t&&Object.keys(t).length>0;return c.useEffect(()=>{t&&Object.keys(t).length===0&&u(m.legacy)},[t]),s?null:e.jsxs("div",{className:"center flex h-[150px] w-full flex-col rounded-lg bg-gray-100/80 dark:bg-zinc-900/80",children:[e.jsx("p",{className:"mb-4 text-sm",children:"使用社交賬號登錄"}),e.jsx(he,{}),e.jsx(ee,{className:i(a?"mt-6":""),variant:"secondary",type:"button",onClick:()=>{u(m.legacy)},children:"免登錄評論"})]})}const Ye=s=>{const{refId:t,className:a,afterSubmit:n,initialValue:r}=s,o=X(),S=d(),y=l();return c.useEffect(()=>{y&&u(m["with-auth"])},[y]),e.jsx(R,{children:e.jsx(Z,{refId:t,afterSubmit:n,initialValue:r,children:e.jsxs("div",{className:p("group relative w-full min-w-0",a),"data-hide-print":!0,children:[e.jsx(Q,{}),e.jsx("div",{className:"relative w-full",children:S?e.jsx(N,{}):o===m.legacy?e.jsx(N,{}):e.jsx(ge,{})})]})})})},N=()=>e.jsx(k,{children:e.jsx(le,{})}),ge=()=>{const s=!!l();return e.jsx(k,{children:s?e.jsx(ce,{}):e.jsx(pe,{})})};export{Ye as CommentBoxRoot};
